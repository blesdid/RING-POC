"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,o){var i=t&&t.prototype instanceof r?t:r,a=Object.create(i.prototype),s=new p(o||[]);return y(a,"_invoke",{value:l(e,n,s)}),a}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function r(){}function o(){}function i(){}function a(t){["next","throw","return"].forEach((function(n){e(t,n,(function(e){return this._invoke(n,e)}))}))}function s(e,t){function r(o,i,a,s){var l=n(e[o],e,i);if("throw"!==l.type){var d=l.arg,c=d.value;return c&&"object"==_typeof(c)&&v.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){d.value=e,a(d)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var o;y(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function l(e,t,r){var o="suspendedStart";return function(i,a){if("executing"===o)throw Error("Generator is already running");if("completed"===o){if("throw"===i)throw a;return{value:m,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var l=d(s,r);if(l){if(l===x)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===o)throw o="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o="executing";var c=n(e,t,r);if("normal"===c.type){if(o=r.done?"completed":"suspendedYield",c.arg===x)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o="completed",r.method="throw",r.arg=c.arg)}}}function d(e,t){var r=t.method,o=e.iterator[r];if(o===m)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=m,d(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),x;var i=n(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,x;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,x):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,x)}function c(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function u(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(c,this),this.reset(!0)}function h(e){if(e||""===e){var t=e[k];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t};return r.next=r}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return f};var m,f={},g=Object.prototype,v=g.hasOwnProperty,y=Object.defineProperty||function(e,t,n){e[t]=n.value},b="function"==typeof Symbol?Symbol:{},k=b.iterator||"@@iterator",w=b.asyncIterator||"@@asyncIterator",S=b.toStringTag||"@@toStringTag";try{e({},"")}catch(w){e=function(e,t,n){return e[t]=n}}f.wrap=t;var x={},L={};e(L,k,(function(){return this}));var E=Object.getPrototypeOf,C=E&&E(E(h([])));C&&C!==g&&v.call(C,k)&&(L=C);var I=i.prototype=r.prototype=Object.create(L);return o.prototype=i,y(I,"constructor",{value:i,configurable:!0}),y(i,"constructor",{value:o,configurable:!0}),o.displayName=e(i,S,"GeneratorFunction"),f.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,i):(t.__proto__=i,e(t,S,"GeneratorFunction")),t.prototype=Object.create(I),t},f.awrap=function(e){return{__await:e}},a(s.prototype),e(s.prototype,w,(function(){return this})),f.AsyncIterator=s,f.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new s(t(e,n,r,o),i);return f.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},a(I),e(I,S,"Generator"),e(I,k,(function(){return this})),e(I,"toString",(function(){return"[object Generator]"})),f.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},f.values=h,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(u),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return i.type="throw",i.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=v.call(o,"catchLoc"),s=v.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var n,r=this.tryEntries.length-1;0<=r;--r)if((n=this.tryEntries[r]).tryLoc<=this.prev&&v.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,x):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),x},finish:function(e){for(var t,n=this.tryEntries.length-1;0<=n;--n)if((t=this.tryEntries[n]).finallyLoc===e)return this.complete(t.completion,t.afterLoc),u(t),x},catch:function(e){for(var t,n=this.tryEntries.length-1;0<=n;--n)if((t=this.tryEntries[n]).tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;u(t)}return o}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:h(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),x}},f}function asyncGeneratorStep(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(a){return void n(a)}s.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){function i(e){asyncGeneratorStep(s,r,o,i,a,"next",e)}function a(e){asyncGeneratorStep(s,r,o,i,a,"throw",e)}var s=e.apply(t,n);i(void 0)}))}}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var LoginAnd2SVController=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"init",value:function(){var t=this;this.initializeHashChangeListener(),this.checkForBannerFlags();var n,r=_createForOfIteratorHelper(this.root.querySelectorAll(".notification-banner-action.close"));try{for(r.s();!(n=r.n()).done;)n.value.addEventListener("click",(function(e){e.preventDefault();var n=e.target.parentElement.parentElement.parentElement;t.closeBanner(n.id)}))}catch(e){r.e(e)}finally{r.f()}var o,i=_createForOfIteratorHelper(this.root.querySelectorAll(".notification-banner-action.opt-in"));try{for(i.s();!(o=i.n()).done;)o.value.addEventListener("click",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,fetch("/users/sign_in/join_beta",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"}});case 4:200===e.sent.status?((r=new URL(window.location.href)).searchParams.has("isLegacy")&&(r.searchParams.delete("isLegacy"),window.history.pushState({},"",r.toString())),window.location.reload()):t.processLoginErrors("opt-in-error"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t.processLoginErrors("opt-in-error");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}())}catch(e){i.e(e)}finally{i.f()}this.root.querySelector(".toggle-password-visibility").addEventListener("click",(function(e){e.preventDefault(),t.togglePasswordVisibility()}));var a=function(){t.continueButton.disabled=!t.emailInput.validity.valid};this.emailInput.addEventListener("input",a),this.emailInput.addEventListener("change",a),this.continueButton.addEventListener("click",(function(e){e.preventDefault(),t.showPasswordInput()})),this.loginButton.addEventListener("click",(function(e){e.preventDefault(),t.toggleLoginForm()})),this.root.querySelector(".action-banner-backdrop.password-updated .action-banner-close").addEventListener("click",(function(e){e.preventDefault(),t.togglePasswordUpdatedBanner()})),this.root.querySelector(".action-banner-backdrop.password-updated .action-banner-accept").addEventListener("click",(function(e){e.preventDefault(),window.location.href="ring://app/login"})),this.root.querySelector(".action-banner-backdrop.password-updated .action-banner-cancel").addEventListener("click",(function(e){e.preventDefault(),t.togglePasswordUpdatedBanner()})),this.root.querySelector(".modal-backdrop.breached-password .modal-close").addEventListener("click",(function(e){e.preventDefault(),t.toggleBreachedPasswordModal()})),this.root.querySelector(".modal-backdrop.breached-password .modal-accept").addEventListener("click",(function(e){e.preventDefault(),window.location.href="/users/password/new"}));var s=this.root.querySelector(".modal-backdrop.breached-password .modal-cancel");s.addEventListener("click",(function(e){"a"===s.tagName.toLocaleLowerCase()&&0<s.getAttribute("href").length||e.preventDefault()})),this.root.querySelector('label[for="extended-session"]').addEventListener("click",(function(e){t.toggleExtendedSession(e)}));for(var l=0,d=[this.root.querySelector(".extended-session-modal-toggle"),this.root.querySelector(".modal-backdrop.extended-session .modal-close"),this.root.querySelector(".modal-backdrop.extended-session .modal-accept")];l<d.length;l++)d[l].addEventListener("click",(function(e){e.preventDefault(),t.toggleExtendedSessionsModal()}));this.root.querySelector('label[for="remember-me"]').addEventListener("click",(function(e){t.toggleRememberMe(e)})),this.otpInput.addEventListener("input",(function(){t.verifyOtpButton.disabled=!t.otpInput.validity.valid})),this.verifyOtpButton.addEventListener("click",(function(e){e.preventDefault(),t.verifyOtpButton.disabled=!0}));for(var c=0,u=[this.root.querySelector(".remember-me-modal-toggle"),this.root.querySelector(".modal-backdrop.remember-me .modal-close"),this.root.querySelector(".modal-backdrop.remember-me .modal-accept")];c<u.length;c++)u[c].addEventListener("click",(function(e){e.preventDefault(),t.toggleRememberMeModal()}));this.resendCodeLink.addEventListener("click",(function(){-1<t.resendCodeLink.className.indexOf("disabled")||(t.resendCodeLinkClicked=!0)}));var p=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.captchaToken=null==n?void 0:n.token,!e.isUserOnLoginStep()){t.next=6;break}return t.next=4,e.login();case 4:case 10:t.next=14;break;case 6:if(!e.resendCodeLinkClicked){t.next=12;break}return e.resendCodeLinkClicked=!1,t.next=10,e.resendOtp();case 12:return t.next=14,e.verifyOtp();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();this.arkoseCaptchaEnabled?window.setupEnforcement=function(t){t.setConfig({selector:".captcha-trigger",onShow:function(){e.isUserOnLoginStep()?e.disableLoginForm():e.disableOTPForm()},onCompleted:p})}:document.querySelectorAll(".captcha-trigger").forEach((function(e){e.addEventListener("click",p)}))}},{key:"initializeHashChangeListener",value:function(){var e=this;window.addEventListener("hashchange",(function(){""===location.hash&&e.displayLoginStep()}))}},{key:"toggleInputErrorBorder",value:function(e){var t=document.getElementById(e);-1===t.className.indexOf("invalid")&&(t.className+=" invalid")}},{key:"clearAllInputErrorBorders",value:function e(){var t,n=_createForOfIteratorHelper(this.root.querySelectorAll("input.invalid"));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.className=r.className.replace("invalid","")}}catch(e){n.e(e)}finally{n.f()}}},{key:"displayLoginError",value:function(e,t){var n=this.root.querySelector(".card.login div.errors.".concat(e)),r=document.createElement("span");r.innerText=t,n.appendChild(r)}},{key:"checkForBannerFlags",value:function(){if(!navigator.cookieEnabled)return history.pushState({},"","?cookies-disabled"),this.displayBanner("cookies-disabled");switch(window.location.search){case"?session-timeout":this.displayBanner("session-timeout");break;case"?login-timeout":this.displayBanner("login-timeout");break;case"?email-updated":this.displayBanner("email-updated");break;case"?password-updated":this.displayBanner("password-updated");break;case"?password-updated-mobile":this.togglePasswordUpdatedBanner();break;case"?rpp":this.displayBanner("rpp");break;case"?account-unlinked":this.displayBanner("account-unlinked")}}},{key:"displayBanner",value:function(e){var t=document.getElementById(e);t.className=t.className.replace("hidden","")}},{key:"closeBanner",value:function(e){var t=document.getElementById(e);t.addEventListener("animationend",(function(){t.style.display="none"})),t.style.display="flex",t.className+=" hidden"}},{key:"togglePasswordUpdatedBanner",value:function(){this.passwordUpdatedActionBanner.className=-1<this.passwordUpdatedActionBanner.className.indexOf("hidden")?"action-banner-backdrop password-updated":"action-banner-backdrop password-updated hidden"}},{key:"togglePasswordVisibility",value:function(){var e=this.root.getElementsByClassName("show-password")[0],t=this.root.getElementsByClassName("hide-password")[0];this.passwordInput.type="password"===this.passwordInput.type?"text":"password","text"===this.passwordInput.type?(t.className="hide-password",e.className="show-password hidden"):(t.className="hide-password hidden",e.className="show-password")}},{key:"showPasswordInput",value:function(){for(var e=this.root.querySelectorAll(".card.login div.errors"),t=0;t<e.length;t++)e[t].innerText="";this.clearAllInputErrorBorders(),this.emailInput.validity.valid?(this.passwordInput.parentElement.className="field",this.passwordInput.focus(),this.continueButton.className+=" hidden",this.continueButton.type="button",this.loginButton.className="login-button captcha-trigger"):(this.toggleInputErrorBorder("email"),0===this.emailInput.value.length?this.displayLoginError("email",window.translations.login["email-required"]):this.displayLoginError("email",window.translations.login["invalid-email"]))}},{key:"toggleBreachedPasswordModal",value:function(){var e=this;this.breachedPasswordModal.style.display="flex",-1<this.breachedPasswordModal.className.indexOf("hidden")?this.breachedPasswordModal.className="modal-backdrop breached-password":(this.breachedPasswordModal.children[0].addEventListener("animationend",(function(){var t=-1<e.breachedPasswordModal.className.indexOf("hidden");e.breachedPasswordModal.style.display=t?"none":"flex"})),this.breachedPasswordModal.className="modal-backdrop breached-password hidden")}},{key:"isUserOnLoginStep",value:function(){return-1<this.root.querySelector(".card.hidden").className.indexOf("login-2sv")}},{key:"toggleLoginForm",value:function(){this.emailInput.disabled=!this.emailInput.disabled,this.passwordInput.disabled=!this.passwordInput.disabled,this.loginButton.disabled=!this.loginButton.disabled}},{key:"disableLoginForm",value:function(){this.emailInput.disabled=!0,this.passwordInput.disabled=!0,this.loginButton.disabled=!0}},{key:"disableOTPForm",value:function(){this.otpInput.disabled=!0,this.disableExtendedSession()}},{key:"login",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,o,i,a,s,l,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.root.querySelectorAll(".card.login div.errors"),r=0;r<n.length;r++)n[r].innerText="";if(this.clearAllInputErrorBorders(),!this.emailInput.validity.valid||0===this.emailInput.value.length||0===this.passwordInput.value.length){e.next=25;break}return o=Object.freeze({email:this.emailInput.value,password:this.passwordInput.value,"captcha-token":this.captchaToken,"csrf-token":this.csrfToken,"expires-ts":this.expiresTsInput.value,"plans-login":this.planReturnStateInput.value,extended:(null===(t=this.extendedSessionInput)||void 0===t?void 0:t.checked)?"on":"off"}),i=this.loginButton.innerText,this.loginButton.innerText=window.translations.login["login-button-logging-in-state"],e.prev=7,this.otpMethod=null,e.next=11,this.attemptLogin(o);case 11:a=e.sent,s=a.url,l=a.otpReceiver,d=a.error,s?window.location.href=s:l?(location.hash="#otp",this.processOtpReceiver(l),this.display2svStep(),this.otpInput.focus()):this.processLoginErrors(d),this.loginButton.innerText=i,e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),console.error(e.t0),this.displayLoginError("password",window.translations.login["something-went-wrong"]);case 23:e.next=26;break;case 25:this.validateLoginStep();case 26:this.toggleLoginForm();case 27:case"end":return e.stop()}}),e,this,[[7,19]])}))),function(){return t.apply(this,arguments)})},{key:"processOtpReceiver",value:function(e){var t=this.prettifyOtpReceiver(e),n=this.otpReceiverEmail.querySelector(".otp-receiver-text"),r=this.otpReceiverSms.querySelector(".otp-receiver-text");-1<e.indexOf("@")?(this.otpReceiverSms.className="otp-receiver sms hidden",r.innerText="",this.totpSubtitle.className="totp-subtitle hidden",this.totpCaption.style.display="none",this.otpReceiverEmail.className="otp-receiver email",this.otpMethod="email",n.innerText=t,this.startTimer()):-1<e.indexOf("x")?(this.otpReceiverEmail.className="otp-receiver email hidden",n.innerText="",this.totpSubtitle.className="totp-subtitle hidden",this.totpCaption.style.display="none",this.otpReceiverSms.className="otp-receiver sms",this.otpMethod="sms",r.innerText=t,this.startTimer()):(n.innerText="",r.innerText="",this.otpReceiverEmail.className="otp-receiver email hidden",this.otpReceiverSms.className="otp-receiver sms hidden",this.login2svSubtitle.className+=" hidden",this.resendCodeLink.style.display="none",this.totpSubtitle.className="totp-subtitle",this.otpMethod="totp",(this.totpCaption.currentStyle?"none"===this.totpCaption.currentStyle.display:"none"===getComputedStyle(this.totpCaption,null).display)&&(this.totpCaption.style.display="block"))}},{key:"displayLoginStep",value:function(){this.loginStep.className="card login",this.loginLegalText.className="legal-text",this.otpStep.className="card login-2sv hidden"}},{key:"display2svStep",value:function(){this.loginStep.className="card login hidden",this.loginLegalText.className="legal-text hidden",this.otpStep.className="card login-2sv"}},{key:"validateLoginStep",value:function(){0!==this.emailInput.value.length&&this.emailInput.validity.valid||(this.toggleInputErrorBorder("email"),0===this.emailInput.value.length?this.displayLoginError("email",window.translations.login["email-required"]):this.displayLoginError("email",window.translations.login["invalid-email"])),0===this.passwordInput.value.length&&(this.toggleInputErrorBorder("password"),this.displayLoginError("password",window.translations.login["please-enter-password"]))}},{key:"processLoginErrors",value:function(e){"account-locked"===e?this.displayLoginError("password",window.translations.login[e]):"invalid-credentials"===e?(this.toggleInputErrorBorder("email"),this.toggleInputErrorBorder("password"),this.displayLoginError("password",window.translations.login[e])):"breached-password"===e?this.toggleBreachedPasswordModal():"invalid-captcha"===e?this.displayLoginError("password",window.translations.login[e]):("unhandled-status"==e||"unknown"==e)&&this.displayLoginError("password",window.translations.login["login-unavailable"])}},{key:"prettifyOtpReceiver",value:function(e){var t,n,r;return-1<e.indexOf("+")?null===(r=null===(n=null===(t=null==e?void 0:e.replace(/^\+(\d{3})(xxx)(xxx)(.*)$/,"+$1 ($2) $3 - $4"))||void 0===t?void 0:t.replace(/^\+(\d{2})(xx)(xxxx)(.*)$/,"+$1 ($2) $3 - $4"))||void 0===n?void 0:n.replace(/^\+(\d{1})(xxx)(xxx)(.*)$/,"+$1 ($2) $3 - $4"))||void 0===r?void 0:r.replace(/x/g,"●"):e.replace(/\*/g,"●")}},{key:"display2svError",value:function(e){var t=document.createElement("span");(this.login2svErrors.currentStyle?"none"===this.login2svErrors.currentStyle.display:"none"===getComputedStyle(this.login2svErrors,null).display)&&(this.login2svErrors.style.display="block"),t.innerText=e,this.login2svErrors.appendChild(t)}},{key:"toggleRememberMe",value:function(e){e.stopPropagation(),e.preventDefault(),this.rememberMeCheckbox.checked=!this.rememberMeCheckbox.checked,this.rememberMeCheckmark.className=this.rememberMeCheckbox.checked?"checkmark checked":"checkmark"}},{key:"toggleExtendedSession",value:function(e){e.stopPropagation(),e.preventDefault(),this.extendedSessionCheckbox.disabled||(this.extendedSessionCheckbox.checked=!this.extendedSessionCheckbox.checked,this.extendedSessionCheckmark.className=this.extendedSessionCheckbox.checked?"checkmark checked":"checkmark")}},{key:"disableExtendedSession",value:function(){this.extendedSessionInput.disabled=!0,this.extendedSessionInput.readOnly=!0,this.extendedSessionCheckmark.className=this.extendedSessionInput.checked?"checkmark checked disabled":"checkmark disabled"}},{key:"enableExtendedSession",value:function(){this.extendedSessionInput.disabled=!1,this.extendedSessionInput.readOnly=!1,this.extendedSessionCheckmark.className=this.extendedSessionInput.checked?"checkmark checked":"checkmark"}},{key:"toggleExtendedSessionDisabledState",value:function(){this.extendedSessionCheckbox.disabled?this.enableExtendedSession():this.disableExtendedSession()}},{key:"toggleRememberMeModal",value:function(){var e=this;-1<this.rememberMeModal.className.indexOf("hidden")?(this.rememberMeModal.className="modal-backdrop remember-me",this.rememberMeModal.style.display="flex"):(this.rememberMeModal.children[0].addEventListener("animationend",(function(){-1<e.rememberMeModal.className.indexOf("hidden")&&(e.rememberMeModal.style.display="none")})),this.rememberMeModal.style.display="flex",this.rememberMeModal.className="modal-backdrop remember-me hidden")}},{key:"toggleExtendedSessionsModal",value:function(){var e=this;-1<this.extendedSessionsModal.className.indexOf("hidden")?(this.extendedSessionsModal.className="modal-backdrop extended-session",this.extendedSessionsModal.style.display="flex"):(this.extendedSessionsModal.children[0].addEventListener("animationend",(function(){-1<e.extendedSessionsModal.className.indexOf("hidden")&&(e.extendedSessionsModal.style.display="none")})),this.extendedSessionsModal.style.display="flex",this.extendedSessionsModal.className="modal-backdrop extended-session hidden")}},{key:"verifyOtp",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,o,i,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.otpInput.disabled=!0,this.login2svErrors.innerText="",this.clearAllInputErrorBorders(),!this.otpInput.validity.valid){e.next=26;break}return r=this.verifyOtpButton.innerText,this.verifyOtpButton.innerText=window.translations["login-2sv"]["submit-button-verifying-state"],o=Object.freeze({email:this.emailInput.value,password:this.passwordInput.value,"2sv-code":this.otpInput.value,"2sv-method":this.otpMethod,"remember-me":(null===(t=this.rememberMeInput)||void 0===t?void 0:t.checked)?"on":"off",extended:(null===(n=this.extendedSessionInput)||void 0===n?void 0:n.checked)?"on":"off","captcha-token":this.captchaToken,"csrf-token":this.csrfToken,"expires-ts":this.expiresTsInput.value,"plans-login":this.planReturnStateInput.value}),e.prev=7,this.disableExtendedSession(),e.next=11,this.attemptLogin(o);case 11:i=e.sent,a=i.url,s=i.error,a?window.location.href=a:s&&(this.process2svErrors(s),this.verifyOtpButton.innerText=r,this.verifyOtpButton.disabled=!1),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),console.error(e.t0),this.display2svError(window.translations["login-2sv"]["something-went-wrong"]),this.verifyOtpButton.disabled=!1;case 22:return e.prev=22,this.otpInput.disabled=!1,this.enableExtendedSession(),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[7,17,22,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"resendOtp",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disableExtendedSession(),this.startTimer(),n=Object.freeze({email:this.emailInput.value,password:this.passwordInput.value,"captcha-token":this.captchaToken,"csrf-token":this.csrfToken,"expires-ts":this.expiresTsInput.value,"plans-login":this.planReturnStateInput.value,extended:(null===(t=this.extendedSessionInput)||void 0===t?void 0:t.checked)?"on":"off"}),e.prev=3,e.next=6,this.attemptLogin(n);case 6:this.otpInput.disabled=!1,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.error(e.t0),this.display2svError(window.translations.login["something-went-wrong"]);case 13:this.enableExtendedSession();case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"startTimer",value:function(){var e=this;clearInterval(this.timerId),this.resendCodeLink.className="resend-code-link disabled",0<this.timerSeconds&&(this.timerId=setInterval((function(){return e.countDownTimer()}),1e3))}},{key:"countDownTimer",value:function(){--this.timerSeconds;var e=window.translations["login-2sv"]["resend-code-link"],t=window.translations["login-2sv"]["resend-code-timer"];this.resendCodeLink.innerText="".concat(t," ").concat(this.timerSeconds,"s"),0>=this.timerSeconds&&(clearInterval(this.timerId),this.resendCodeLink.innerText=e,this.resendCodeLink.className="resend-code-link captcha-trigger",this.timerSeconds=60)}},{key:"process2svErrors",value:function(e){this.toggleInputErrorBorder("2sv-code"),("invalid-code"===e||"account-locked"==e)&&this.display2svError(window.translations["login-2sv"][e])}},{key:"attemptLogin",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/users/sign_in".concat(location.search),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 2:if(406!==(n=e.sent).status&&429!==n.status){e.next=7;break}throw new Error(window.translations.login["rate-limited"]);case 7:if(500!==n.status&&502!==n.status&&503!==n.status){e.next=9;break}throw new Error(window.translations.login["login-unavailable"]);case 9:return e.next=11,n.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]);var t}();LoginAnd2SVController.root=document.getElementById("root"),LoginAnd2SVController.loginStep=LoginAnd2SVController.root.querySelector(".card.login"),LoginAnd2SVController.emailInput=document.getElementById("email"),LoginAnd2SVController.passwordInput=document.getElementById("password"),LoginAnd2SVController.expiresTsInput=document.getElementById("expires-ts"),LoginAnd2SVController.csrfToken=DomUtils.getValueById("csrf-token"),LoginAnd2SVController.arkoseCaptchaEnabled="true"===DomUtils.getValueById("arkose-captcha-enabled"),LoginAnd2SVController.planReturnStateInput=document.getElementById("plans-login"),LoginAnd2SVController.continueButton=LoginAnd2SVController.root.querySelector(".continue-button"),LoginAnd2SVController.loginButton=LoginAnd2SVController.root.querySelector(".login-button"),LoginAnd2SVController.loginLegalText=LoginAnd2SVController.root.querySelector(".legal-text"),LoginAnd2SVController.passwordUpdatedActionBanner=LoginAnd2SVController.root.querySelector(".action-banner-backdrop.password-updated"),LoginAnd2SVController.breachedPasswordModal=LoginAnd2SVController.root.querySelector(".modal-backdrop.breached-password"),LoginAnd2SVController.login2svSubtitle=LoginAnd2SVController.root.querySelector(".subtitle.login-2sv"),LoginAnd2SVController.otpStep=LoginAnd2SVController.root.querySelector(".card.login-2sv"),LoginAnd2SVController.otpReceiverEmail=LoginAnd2SVController.root.querySelector(".otp-receiver.email"),LoginAnd2SVController.otpReceiverSms=LoginAnd2SVController.root.querySelector(".otp-receiver.sms"),LoginAnd2SVController.totpSubtitle=LoginAnd2SVController.root.querySelector(".totp-subtitle"),LoginAnd2SVController.totpCaption=LoginAnd2SVController.root.querySelector(".totp-caption"),LoginAnd2SVController.otpInput=document.getElementById("2sv-code"),LoginAnd2SVController.rememberMeInput=document.getElementById("remember-me"),LoginAnd2SVController.rememberMeCheckbox=LoginAnd2SVController.root.querySelector('input[type="checkbox"][name="remember-me"]'),LoginAnd2SVController.rememberMeCheckmark=LoginAnd2SVController.root.querySelector('label[for="remember-me"] .checkmark'),LoginAnd2SVController.extendedSessionInput=document.getElementById("extended-session"),LoginAnd2SVController.extendedSessionCheckbox=LoginAnd2SVController.root.querySelector('input[type="checkbox"][name="extended-session"]'),LoginAnd2SVController.extendedSessionCheckmark=LoginAnd2SVController.root.querySelector('label[for="extended-session"] .checkmark'),LoginAnd2SVController.verifyOtpButton=LoginAnd2SVController.root.querySelector(".login-2sv-button"),LoginAnd2SVController.login2svErrors=LoginAnd2SVController.root.querySelector(".errors.login-2sv"),LoginAnd2SVController.rememberMeModal=LoginAnd2SVController.root.querySelector(".modal-backdrop.remember-me"),LoginAnd2SVController.extendedSessionsModal=LoginAnd2SVController.root.querySelector(".modal-backdrop.extended-session"),LoginAnd2SVController.resendCodeLink=LoginAnd2SVController.root.querySelector(".resend-code-link"),LoginAnd2SVController.timerSeconds=60,LoginAnd2SVController.resendCodeLinkClicked=!1,LoginAnd2SVController.otpMethod=null,LoginAnd2SVController.init();